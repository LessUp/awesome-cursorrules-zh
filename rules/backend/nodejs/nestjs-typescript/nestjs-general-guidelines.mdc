---
description: 在 'src' 目录中指定 NestJS 特定的架构原则、模块化设计和测试实践。
globs: src/**/*.*
---
- 使用模块化架构
- 将 API 封装在模块中。
  - 每个主要域/路由一个模块。
  - 一个控制器对应其路由。
  - 以及其他控制器对应次要路由。
  - 一个包含数据类型的 models 文件夹。
  - 使用 class-validator 验证输入的 DTO。
  - 为输出声明简单类型。
  - 一个包含业务逻辑和持久化的服务模块。
  - 使用 MikroORM 进行数据持久化的实体。
  - 每个实体一个服务。
- 一个用于 nest 工件的核心模块
  - 用于异常处理的全局过滤器。
  - 用于请求管理的全局中间件。
  - 用于权限管理的守卫。
  - 用于请求管理的拦截器。
- 一个用于模块间共享服务的共享模块。
  - 工具
  - 共享业务逻辑
- 使用标准的 Jest 框架进行测试。
- 为每个控制器和服务编写测试。
- 为每个 api 模块编写端到端测试。
- 为每个控制器添加 admin/test 方法作为冒烟测试。
