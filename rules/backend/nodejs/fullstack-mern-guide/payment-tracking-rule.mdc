---
description: 支付追踪规则
globs: []
alwaysApply: false
---

# 支付追踪规则

本规则集定义了全栈 MERN 指南中支付追踪的规范和最佳实践，确保支付流程的透明度和可审计性。

## 1. 支付状态管理

- **清晰的支付状态**: 定义明确的支付状态流，例如：`待支付` -> `支付中` -> `支付成功` / `支付失败` / `已退款`。
- **状态更新**: 支付状态应通过可靠的机制（如支付网关的回调通知）进行更新，并记录每次状态变更的时间和操作者。

## 2. 交易记录

- **详细的交易信息**: 记录每笔支付交易的详细信息，包括交易ID、金额、货币、支付方式、支付时间、用户ID等。
- **支付网关响应**: 完整记录支付网关返回的所有信息，以便后续核对和问题排查。

## 3. 异常处理与重试机制

- **支付失败处理**: 对于支付失败的交易，应有明确的错误码和错误信息，并提供用户友好的提示。
- **重试策略**: 对于临时性网络问题或支付网关错误，可以实现幂等的重试机制。

## 4. 对账与审计

- **定期对账**: 系统应支持与支付网关进行定期对账，核对交易记录的一致性。
- **可审计日志**: 所有支付相关的操作和状态变更都应记录详细日志，便于审计和追踪。

## 5. 安全性

- **敏感信息保护**: 绝不存储用户的完整支付卡信息。只存储支付网关返回的令牌或部分信息。
- **数据加密**: 传输和存储所有支付相关数据时，应使用强加密措施。
- **幂等性**: 确保支付请求的幂等性，避免重复扣款。
