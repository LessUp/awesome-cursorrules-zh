name: è´¨é‡æ£€æŸ¥

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  validate:
    runs-on: ubuntu-latest
    name: éªŒè¯æ–‡ä»¶æ ¼å¼

    steps:
    - uses: actions/checkout@v4

    - name: æ£€æŸ¥ Markdown æ–‡ä»¶
      uses: DavidAnson/markdownlint-cli2-action@v13
      with:
        globs: '**/*.md'
        config: |
          {
            "MD013": false,
            "MD033": false,
            "MD041": false
          }

    - name: éªŒè¯ .cursorrules æ–‡ä»¶æ ¼å¼
      run: |
        echo "æ£€æŸ¥ .cursorrules æ–‡ä»¶..."
        find . -name ".cursorrules" -type f | while read file; do
          echo "éªŒè¯æ–‡ä»¶: $file"
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
          if [ ! -s "$file" ]; then
            echo "é”™è¯¯: $file æ–‡ä»¶ä¸ºç©º"
            exit 1
          fi
          echo "âœ… $file æ ¼å¼æ­£ç¡®"
        done

    - name: æ£€æŸ¥ç›®å½•ç»“æ„
      run: |
        echo "éªŒè¯é¡¹ç›®ç›®å½•ç»“æ„..."
        required_dirs=("rules" "docs" "examples" "templates")
        for dir in "${required_dirs[@]}"; do
          if [ ! -d "$dir" ]; then
            echo "é”™è¯¯: ç¼ºå°‘å¿…éœ€ç›®å½• $dir"
            exit 1
          fi
          echo "âœ… ç›®å½• $dir å­˜åœ¨"
        done

    - name: ç»Ÿè®¡ç¿»è¯‘è¿›åº¦
      run: |
        echo "ğŸ“Š ç¿»è¯‘è¿›åº¦ç»Ÿè®¡:"
        total_rules=$(find rules -type d -mindepth 3 -maxdepth 3 | wc -l)
        echo "æ€»è§„åˆ™é›†æ•°é‡: $total_rules"
        
        frontend_rules=$(find rules/frontend -type d -mindepth 2 -maxdepth 2 | wc -l)
        backend_rules=$(find rules/backend -type d -mindepth 2 -maxdepth 2 | wc -l)
        
        echo "å‰ç«¯è§„åˆ™é›†: $frontend_rules"
        echo "åç«¯è§„åˆ™é›†: $backend_rules"
